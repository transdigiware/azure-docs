---
title: 'Azure AD ECMA Connector Host configuration'
description: This article describes how to configure the Azure AD ECMA Connector Host.
services: active-directory
author: billmath
manager: mtillman
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 06/04/2021
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
---

# Configure the Azure AD ECMA Connector Host and the provisioning agent

>[!IMPORTANT]
> The on-premises provisioning preview is currently in an invitation-only preview. To request access to the capability, use the [access request form](https://aka.ms/onpremprovisioningpublicpreviewaccess). We'll open the preview to more customers and connectors over the next few months as we prepare for general availability.

This article provides guidance on how to configure the Azure Active Directory (Azure AD) ECMA Connector Host and the provisioning agent after you've successfully installed them.

This flow guides you through the process of installing and configuring the Azure AD ECMA Connector Host. 

 ![Diagram that shows the installation flow.](./media/on-premises-ecma-configure/flow-1.png)

For more installation and configuration information, see:
   - [Prerequisites for the Azure AD ECMA Connector Host](on-premises-ecma-prerequisites.md)
   - [Installation of the Azure AD ECMA Connector Host](on-premises-ecma-install.md)
   - [Azure AD ECMA Connector Host generic SQL connector configuration](on-premises-sql-connector-configure.md)
   
## Configure the Azure AD ECMA Connector Host
Configuring the Azure AD ECMA Connector Host occurs in two parts:
    
   - **Configure the settings**: Configure the port and certificate for the Azure AD ECMA Connector Host to use. This step is only done the first time the ECMA Connector Host is started.
   - **Create a connector**: Create a connector (for example, SQL or LDAP) to allow the Azure AD ECMA Connector Host to export or import data to a data source.

### Configure the settings
When you first start the Azure AD ECMA Connector Host, you'll see a port number that's filled with the default **8585**. 

 ![Screenshot that shows configuring your settings.](.\media\on-premises-ecma-configure\configure-1.png)

For the preview, you'll need to generate a new self-signed certificate.

 >[!NOTE]
 >This preview uses a time-sensitive certificate. The autogenerated certificate will be self-signed. Part of the trusted root and the SAN matches the hostname.


### Create a connector
Now you must create a connector for the Azure AD ECMA Connector Host to use. This connector will allow the ECMA Connector Host to export data to the data source for the connector you create. You can also use it to import data if you want.

The configuration steps for each of the individual connectors are longer and are provided in their own documents.

To create and configure a connector, use the [generic SQL connector](on-premises-sql-connector-configure.md). This connector will work with Microsoft SQL databases, such as Azure SQL Database or Azure Database for MySQL.

## Establish connectivity between Azure AD and the Azure AD ECMA Connector Host
The following sections guide you through establishing connectivity with the on-premises Azure AD ECMA Connector Host and Azure AD.

### Ensure the ECMA2Host service is running
1. On the server running the Azure AD ECMA Connector Host, select **Start**.
1. Enter **run**, and enter **services.msc** in the box.
1. In the **Services** list, ensure that **Microsoft ECMA2Host** is present and running. If not, select **Start**.

   ![Screenshot that shows that the service is running.](.\media\on-premises-ecma-configure\configure-2.png)

### Add an enterprise application
1. Sign in to the Azure portal as an application administrator.
1. In the portal, go to **Azure Active Directory** > **Enterprise applications**.
1. Select **New application**.

   ![Screenshot that shows Add new application.](.\media\on-premises-ecma-configure\configure-4.png)
1. Locate the **On-premises provisioning** application from the gallery, and select **Create**.

### Configure the application and test
  1. After the application is created, select the **Provisioning** page.
  1. Select **Get started**.
  
     ![Screenshot that shows Get started.](.\media\on-premises-ecma-configure\configure-6.png)
  1. On the **Provisioning** page, change **Provisioning Mode** to **Automatic**.

      ![Screenshot that shows changing the mode.](.\media\on-premises-ecma-configure\configure-7.png)
  1. In the **On-Premises Connectivity** section, select the agent that you deployed and select **Assign Agent(s)**.
  
      ![Screenshot that shows Assign an agent.](.\media\on-premises-ecma-configure\configure-8.png)</br>

      >[!NOTE]
      >After you add the agent, wait 10 to 20 minutes for the registration to complete. The connectivity test won't work until the registration completes.
      >
      >Alternatively, you can force the agent registration to complete by restarting the provisioning agent on your server. Go to your server, search for **services** in the Windows search bar, identify the **Azure AD Connect Provisioning Agent Service**, right-click the service, and restart.

  1. After 10 minutes, under the **Admin Credentials** section, enter the following URL. Replace the `"connectorName"` portion with the name of the connector on the ECMA Host.

      |Property|Value|
      |-----|-----|
      |Tenant URL|https://localhost:8585/ecma2host_connectorName/scim|

  1. Enter the secret token value that you defined when you created the connector.
  1. Select **Test Connection** and wait one minute.
  
     ![Screenshot that shows Test Connection.](.\media\on-premises-ecma-configure\configure-5.png)

     >[!NOTE]
     >Be sure to wait 10 to 20 minutes after you assign the agent to test the connection. The connection will fail if registration hasn't finished.

  1. After the connection test is successful, select **Save**.</br>
  
     ![Screenshot that shows Successful test.](.\media\on-premises-ecma-configure\configure-9.png)

## Configure who's in scope for provisioning
Now that you have the Azure AD ECMA Connector Host talking with Azure AD, you can move on to configuring who's in scope for provisioning. The following sections provide information on how to scope your users.

### Assign users to your application
By using Azure AD, you can scope who should be provisioned based on assignment to an application or by filtering on a particular attribute. Determine who should be in scope for provisioning, and define your scoping rules, as necessary. For more information, see [Manage user assignment for an app in Azure Active Directory](../../active-directory/manage-apps/assign-user-or-group-access-portal.md).

### Configure your attribute mappings
Now you map the user attributes in Azure AD to the attributes in the target application. The Azure AD provisioning service relies on the SCIM standard for provisioning. As a result, the attributes surfaced have the SCIM name space. The following example shows how you can map the **mail** and **objectId** attributes in Azure AD to the **Email** and **InternalGUID** attributes in an application.

>[!NOTE]
>The default mapping connects **userPrincipalName** to an attribute name *PLACEHOLDER*. You must change the *PLACEHOLDER* attribute to one that's found in your application. For more information, see [Matching users in the source and target systems](customize-application-attributes.md#matching-users-in-the-source-and-target--systems).

|Attribute name in Azure AD|Attribute name in SCIM|Attribute name in target application|
|-----|-----|-----|
|mail|urn:ietf:params:scim:schemas:extension:ECMA2Host:2.0:User:Email|Email|
|objectId|urn:ietf:params:scim:schemas:extension:ECMA2Host:2.0:User:InternalGUID|InternalGUID|

### Configure attribute mapping
 1. In the Azure AD portal, under **Enterprise applications**, select the **Provisioning** page.
 2. Select **Get started**.
 3. Expand **Mappings**, and select **Provision Azure Active Directory Users**.
 
    ![Screenshot that shows Provision Azure Active Directory Users.](.\media\on-premises-ecma-configure\configure-10.png)
 1. Select **Add New Mapping**.
 
    ![Screenshot that shows Add New Mapping.](.\media\on-premises-ecma-configure\configure-11.png)
 1. Specify the source and target attributes, and select **OK**.</br>
 
    ![Screenshot that shows the Edit Attribute pane.](.\media\on-premises-ecma-configure\configure-12.png)


For more information on mapping user attributes from applications to Azure AD, see [Tutorial - Customize user provisioning attribute-mappings for SaaS applications in Azure Active Directory](customize-application-attributes.md).

### Test your configuration by provisioning users on demand
To test your configuration, you can use on-demand provisioning of users. For information on provisioning users on-demand, see [On-demand provisioning](provision-on-demand.md).

 1. Go to the single sign-on pane, and then go back to the provisioning pane. On the new provisioning overview pane, select **On-demand**.
 1. Test provisioning a few users on demand as described in [On-demand provisioning in Azure Active Directory](provision-on-demand.md).
 
    ![Screenshot that shows testing provisioning.](.\media\on-premises-ecma-configure\configure-13.png)

### Start provisioning users
 1. After on-demand provisioning is successful, go back to the provisioning configuration page. Ensure that the scope is set to only assigned users and groups, turn the provisioning status to **On**, and select **Save**.
 
    ![Screenshot that shows starting provisioning.](.\media\on-premises-ecma-configure\configure-14.png)

1. Wait several minutes for provisioning to start. It might take up to 40 minutes. After the provisioning job has completed, as described in the next section, you can change the provisioning status to **Off**, and select **Save**. This step will stop the provisioning service from running in the future.

### Verify users were successfully provisioned
After waiting, check your data source to see if new users are being provisioned.

 ![Screenshot that shows verifying that users are provisioned.](.\media\on-premises-ecma-configure\configure-15.png)

## Monitor your deployment

1. Use the provisioning logs to determine which users were provisioned successfully or unsuccessfully.
1. Build custom alerts, dashboards, and queries by using the Azure Monitor integration.
1. If the provisioning configuration seems to be in an unhealthy state, the application goes into quarantine. Learn more about [quarantine states](https://github.com/MicrosoftDocs/azure-docs-pr/compare/application-provisioning-quarantine-status.md?expand=1).

## Next steps

- [Azure AD ECMA Connector Host prerequisites](on-premises-ecma-prerequisites.md)
- [Azure AD ECMA Connector Host installation](on-premises-ecma-install.md)
- [Generic SQL connector](on-premises-sql-connector-configure.md)
